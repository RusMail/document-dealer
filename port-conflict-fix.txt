# Исправление конфликта портов (port already allocated)

## Проблема: Порт 3002 уже занят

### Шаг 1: Проверьте, какие контейнеры используют порт 3002
docker ps -a | grep 3002

### Шаг 2: Остановите все контейнеры document-dealer
docker compose down document-dealer
docker ps | grep document

### Шаг 3: Проверьте, что порт свободен
netstat -tlnp | grep 3002 || echo "Port 3002 is free"

### Шаг 4: Если порт занят другим процессом
# Найдите процесс:
lsof -i :3002 || echo "No process found"

# Убейте процесс (если нужно):
# kill -9 PID_NUMBER

### Шаг 5: Проверьте volumes
docker volume ls | grep document

### Шаг 6: Удалите старые volumes (если нужно)
docker volume rm srv-server_document-dealer-data || true

### Шаг 7: Запустите заново
cd /srv/server
docker compose up --build -d document-dealer

### Шаг 8: Проверьте статус
docker compose ps
docker ps | grep 3002

### Шаг 9: Тестируйте
curl http://localhost:3002/api/health

### Шаг 10: Если все еще проблемы

# 1. Проверьте, что нет других контейнеров
docker ps -a | grep -E "(3002|document)"

# 2. Остановите все контейнеры
docker compose down

# 3. Удалите volumes
docker volume prune -f

# 4. Запустите только необходимые сервисы
docker compose up -d caddy n8n
docker compose up -d document-dealer

### Шаг 11: Мониторинг
# Запустите логи и мониторьте
docker compose logs -f document-dealer &
sleep 10
curl http://localhost:3002/api/health
kill %1
